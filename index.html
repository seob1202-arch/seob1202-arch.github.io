<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StayPick AI - ë‚˜ë§Œì˜ ì—¬í–‰ íë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Pretendard', 'sans-serif'] },
                    colors: { primary: '#FF385C', dark: '#222222', bg: '#F7F7F7' },
                    boxShadow: { 'float': '0 6px 16px rgba(0,0,0,0.08)' },
                    animation: { 'fade-in-up': 'fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards' },
                    keyframes: { fadeInUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .radio-option input:checked + div { border-color: #FF385C; background-color: #FFF0F3; color: #FF385C; font-weight: 700; box-shadow: 0 4px 12px rgba(255, 56, 92, 0.15); transform: translateY(-2px); }
        .radio-option div { transition: all 0.2s ease-in-out; }
        .filter-chip { transition: all 0.2s; white-space: nowrap; }
        .filter-chip.active { background-color: #222222; color: white; border-color: #222222; font-weight: 700; }
        
        /* Modal Transition */
        #comment-modal, #success-modal { transition: opacity 0.2s ease, visibility 0.2s ease; }
        .modal-hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .modal-visible { opacity: 1; visibility: visible; pointer-events: auto; }
        
        /* Dropdown Animation */
        #location-dropdown { transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1); transform-origin: top right; }
        #location-dropdown.hidden { opacity: 0; transform: scale(0.95); pointer-events: none; }
        #location-dropdown:not(.hidden) { opacity: 1; transform: scale(1); pointer-events: auto; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-dark antialiased pb-10">

    <div class="max-w-[600px] mx-auto bg-white min-h-screen shadow-2xl relative flex flex-col">
        <header class="sticky top-0 z-40 bg-white/90 backdrop-blur-md border-b border-gray-100 px-5 py-4 flex justify-between items-center">
            <h1 class="text-xl font-extrabold text-primary tracking-tight cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">StayPick<span class="text-dark font-normal">.AI</span></h1>
            <button class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-500"><i class="fa-regular fa-user"></i></button>
        </header>

        <section class="px-5 pt-6 pb-8 bg-gradient-to-b from-white to-gray-50">
            <div class="mb-6"><h2 class="text-2xl font-bold leading-tight mb-2">ì–´ë–¤ ì—¬í–‰ì„<br>ê¿ˆê¾¸ì‹œë‚˜ìš”?</h2><p class="text-sm text-gray-500">ë¹…ë°ì´í„°ê°€ ë‹¹ì‹ ì˜ ì·¨í–¥ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p></div>
            <div class="bg-white rounded-3xl p-6 shadow-float border border-gray-100 relative overflow-visible">
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-rose-100 rounded-full blur-3xl opacity-50 pointer-events-none"></div>
                <div class="space-y-8 relative z-10">
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 block">01. Companions</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="radio-option cursor-pointer block"><input type="radio" name="who" value="couple" class="hidden" checked><div class="border border-gray-100 bg-gray-50 rounded-2xl p-3 text-center h-full flex flex-col justify-center items-center hover:bg-white"><span class="text-xl mb-1">ğŸ‘©â€â¤ï¸â€ğŸ‘¨</span><span class="text-xs font-medium text-gray-600">ì»¤í”Œ/ë¡œë§¨í‹±</span></div></label>
                            <label class="radio-option cursor-pointer block"><input type="radio" name="who" value="friends" class="hidden"><div class="border border-gray-100 bg-gray-50 rounded-2xl p-3 text-center h-full flex flex-col justify-center items-center hover:bg-white"><span class="text-xl mb-1">ğŸ‘¯â€â™€ï¸</span><span class="text-xs font-medium text-gray-600">ìš°ì • ì—¬í–‰</span></div></label>
                            <label class="radio-option cursor-pointer block"><input type="radio" name="who" value="solo" class="hidden"><div class="border border-gray-100 bg-gray-50 rounded-2xl p-3 text-center h-full flex flex-col justify-center items-center hover:bg-white"><span class="text-xl mb-1">ğŸ’</span><span class="text-xs font-medium text-gray-600">ë‚˜í™€ë¡œ</span></div></label>
                            <label class="radio-option cursor-pointer block"><input type="radio" name="who" value="work" class="hidden"><div class="border border-gray-100 bg-gray-50 rounded-2xl p-3 text-center h-full flex flex-col justify-center items-center hover:bg-white"><span class="text-xl mb-1">ğŸ’»</span><span class="text-xs font-medium text-gray-600">ì›Œì¼€ì´ì…˜</span></div></label>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 block">02. Priority</label>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar py-1 pl-1">
                            <label class="radio-option cursor-pointer shrink-0"><input type="radio" name="vibe" value="photo" class="hidden" checked><div class="border border-gray-100 bg-gray-50 rounded-full px-5 py-3 text-xs font-medium text-gray-600">âœ¨ ê°ì„±/ì¸ìƒìƒ·</div></label>
                            <label class="radio-option cursor-pointer shrink-0"><input type="radio" name="vibe" value="price" class="hidden"><div class="border border-gray-100 bg-gray-50 rounded-full px-5 py-3 text-xs font-medium text-gray-600">ğŸ’° ê°€ì„±ë¹„ ìµœê³ </div></label>
                            <label class="radio-option cursor-pointer shrink-0"><input type="radio" name="vibe" value="local" class="hidden"><div class="border border-gray-100 bg-gray-50 rounded-full px-5 py-3 text-xs font-medium text-gray-600">ğŸ¡ í˜„ì§€ì¸ ëŠë‚Œ</div></label>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 block">03. Destination</label>
                        <div class="relative">
                            <i class="fa-solid fa-location-dot absolute left-4 top-3.5 text-gray-400 text-sm"></i>
                            <select id="pref-location" class="w-full bg-gray-50 border border-gray-100 rounded-xl pl-10 pr-8 py-3 text-sm font-semibold text-dark appearance-none focus:outline-none focus:ring-2 focus:ring-primary/20 transition">
                                <option value="all">ëª¨ë“  ì—¬í–‰ì§€ (All Cities)</option>
                                <option value="ì˜êµ­">ğŸ‡¬ğŸ‡§ ì˜êµ­ ëŸ°ë˜</option>
                                <option value="í”„ë‘ìŠ¤">ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤ íŒŒë¦¬</option>
                                <option value="ì¼ë³¸">ğŸ‡¯ğŸ‡µ ì¼ë³¸ ì˜¤ì‚¬ì¹´</option>
                                <option value="ë¯¸êµ­">ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ë‰´ìš•</option>
                                <option value="ì´íƒˆë¦¬ì•„">ğŸ‡®ğŸ‡¹ ì´íƒˆë¦¬ì•„ ë¡œë§ˆ</option>
                            </select>
                            <i class="fa-solid fa-chevron-down absolute right-4 top-4 text-gray-300 text-xs pointer-events-none"></i>
                        </div>
                    </div>
                    <button onclick="startAnalysis()" class="w-full bg-gradient-to-r from-primary to-rose-600 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-rose-200 hover:shadow-xl transition transform active:scale-[0.98] flex justify-center items-center group"><i class="fa-solid fa-wand-magic-sparkles mr-2 group-hover:rotate-12 transition"></i><span>AI ë§ì¶¤ ìˆ™ì†Œ ì¶”ì²œë°›ê¸°</span></button>
                </div>
            </div>
        </section>

        <div id="loading-overlay" class="hidden fixed inset-0 z-50 bg-white/98 flex flex-col items-center justify-center px-8 text-center backdrop-blur-sm">
            <div class="w-16 h-16 border-4 border-gray-100 border-t-primary rounded-full animate-spin mb-6"></div>
            <h3 class="text-xl font-bold mb-2 text-dark">AI ë¶„ì„ ì¤‘...</h3>
            <p id="loading-text" class="text-sm text-gray-500 animate-pulse">ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <section id="result-container" class="hidden px-5 mb-8 scroll-mt-20">
            <div class="flex items-center justify-between mb-4"><h3 class="font-bold text-xl flex items-center"><span class="text-primary mr-2"><i class="fa-solid fa-crown"></i></span> AI Top 3 Picks</h3><button onclick="resetAI()" class="text-xs text-gray-400 underline">ë‹¤ì‹œí•˜ê¸°</button></div>
            <div id="recommendation-list" class="flex gap-4 overflow-x-auto no-scrollbar pb-6 px-1 -mx-1 snap-x snap-mandatory"></div>
            <hr class="border-gray-100">
        </section>

        <section class="px-5 flex-1 pb-10">
            <div class="sticky top-[70px] z-30 bg-white/95 backdrop-blur -mx-5 px-5 border-b border-gray-50 mb-4 shadow-sm">
                <div class="relative py-3">
                    <input type="text" id="search-input" placeholder="ìˆ™ì†Œëª…, ì§€ì—­, í¸ì˜ì‹œì„¤ ê²€ìƒ‰" class="w-full bg-gray-100 border-none rounded-full py-3 pl-11 pr-4 text-sm text-dark placeholder-gray-400 focus:ring-2 focus:ring-primary/50 transition"><i class="fa-solid fa-magnifying-glass absolute left-4 top-6 text-gray-400"></i>
                </div>
                
                <div class="flex justify-between items-center pb-3">
                    <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1 mr-2" id="sort-filter-container">
                        <button onclick="changeSort('recommend', this)" class="filter-chip active border border-gray-200 bg-white text-dark px-3 py-1.5 rounded-full text-xs font-medium shrink-0">ì¶”ì²œìˆœ</button>
                        <button onclick="changeSort('price', this)" class="filter-chip border border-gray-200 bg-white text-gray-500 px-3 py-1.5 rounded-full text-xs font-medium shrink-0">ìµœì €ê°€ìˆœ</button>
                        <button onclick="changeSort('reviews', this)" class="filter-chip border border-gray-200 bg-white text-gray-500 px-3 py-1.5 rounded-full text-xs font-medium shrink-0">ë¦¬ë·°ë§ì€ìˆœ</button>
                        <button onclick="changeSort('rating', this)" class="filter-chip border border-gray-200 bg-white text-gray-500 px-3 py-1.5 rounded-full text-xs font-medium shrink-0">í‰ì ìˆœ</button>
                    </div>

                    <div class="relative shrink-0">
                        <button onclick="toggleLocDropdown()" id="loc-btn" class="flex items-center gap-1 border border-gray-200 bg-white text-dark px-3 py-1.5 rounded-full text-xs font-bold shadow-sm hover:bg-gray-50 transition">
                            <span id="current-loc-text">ëª¨ë“  ì§€ì—­</span> <i class="fa-solid fa-chevron-down text-[10px] ml-1"></i>
                        </button>
                        
                        <div id="location-dropdown" class="hidden absolute right-0 top-full mt-2 w-32 bg-white rounded-xl shadow-xl border border-gray-100 z-50 overflow-hidden py-1">
                            <button onclick="changeLocation('all')" class="w-full text-left px-4 py-2 text-xs hover:bg-gray-50 text-dark font-medium">ì „ì²´ë³´ê¸°</button>
                            <button onclick="changeLocation('ì˜êµ­')" class="w-full text-left px-4 py-2 text-xs hover:bg-gray-50 text-gray-500">ğŸ‡¬ğŸ‡§ ì˜êµ­</button>
                            <button onclick="changeLocation('í”„ë‘ìŠ¤')" class="w-full text-left px-4 py-2 text-xs hover:bg-gray-50 text-gray-500">ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤</button>
                            <button onclick="changeLocation('ì´íƒˆë¦¬ì•„')" class="w-full text-left px-4 py-2 text-xs hover:bg-gray-50 text-gray-500">ğŸ‡®ğŸ‡¹ ì´íƒˆë¦¬ì•„</button>
                            <button onclick="changeLocation('ë¯¸êµ­')" class="w-full text-left px-4 py-2 text-xs hover:bg-gray-50 text-gray-500">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</button>
                            <button onclick="changeLocation('ì¼ë³¸')" class="w-full text-left px-4 py-2 text-xs hover:bg-gray-50 text-gray-500">ğŸ‡¯ğŸ‡µ ì¼ë³¸</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-end mb-4"><h3 class="font-bold text-lg text-dark">ìˆ™ì†Œ ë¦¬ìŠ¤íŠ¸</h3><span id="total-count" class="text-xs text-gray-400">Loading...</span></div>
            <div id="main-list" class="space-y-5">
                <div class="animate-pulse flex space-x-4 mb-4"><div class="rounded-xl bg-gray-200 h-24 w-24"></div><div class="flex-1 space-y-2 py-1"><div class="h-4 bg-gray-200 rounded w-3/4"></div><div class="h-4 bg-gray-200 rounded w-1/2"></div></div></div>
            </div>
        </section>

        <div id="comment-modal" class="modal-hidden fixed inset-0 z-50 flex items-end justify-center sm:items-center">
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeCommentModal()"></div>
            <div class="bg-white w-full max-w-[500px] h-[85vh] sm:h-auto sm:max-h-[80vh] sm:rounded-2xl rounded-t-2xl z-10 flex flex-col relative shadow-2xl">
                <div class="px-5 py-4 border-b border-gray-100 flex justify-between items-center bg-white rounded-t-2xl">
                    <h3 class="font-bold text-lg">ğŸ“ ì´ìš©ì ë¦¬ë·°</h3>
                    <button onclick="closeCommentModal()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200"><i class="fa-solid fa-xmark"></i></button>
                </div>
                
                <div id="modal-comments-list" class="flex-1 overflow-y-auto p-5 space-y-4 bg-gray-50"></div>

                <div class="p-5 border-t border-gray-100 bg-white sm:rounded-b-2xl">
                    <div class="relative">
                        <textarea id="comment-input" class="w-full bg-gray-100 border-none rounded-xl p-4 text-sm focus:ring-2 focus:ring-primary/20 focus:bg-white transition resize-none h-24" placeholder="ì†”ì§í•œ ê²½í—˜ì„ ë‚¨ê²¨ì£¼ì„¸ìš”."></textarea>
                        <button onclick="submitComment()" class="absolute bottom-3 right-3 bg-primary text-white text-xs font-bold px-3 py-1.5 rounded-lg hover:bg-rose-600 transition">ë“±ë¡í•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="success-modal" class="modal-hidden fixed inset-0 z-[60] flex items-center justify-center px-4">
            <div class="bg-white rounded-2xl shadow-2xl p-6 text-center w-64 transform transition-all scale-100 relative overflow-hidden">
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3 text-green-500 text-xl">
                    <i class="fa-solid fa-check"></i>
                </div>
                <h4 class="font-bold text-dark text-base mb-1">ë“±ë¡ ì™„ë£Œ!</h4>
                <p class="text-xs text-gray-500">ì†Œì¤‘í•œ í›„ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <section class="px-5 pb-8">
            <a href="https://blog.naver.com/example" target="_blank" class="block w-full group">
                <div class="bg-gray-900 rounded-2xl p-5 relative overflow-hidden shadow-lg transform transition group-hover:scale-[0.99]">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-gray-800 rounded-full mix-blend-overlay filter blur-2xl opacity-50 -mr-10 -mt-10"></div>
                    <div class="relative z-10 flex items-center justify-between">
                        <div>
                            <span class="text-[10px] font-bold text-primary uppercase tracking-widest mb-1 block">EXPERT INSIGHTS</span>
                            <h4 class="text-white font-bold text-lg leading-snug">ì‹¤íŒ¨ ì—†ëŠ” ì—¬í–‰ì„ ìœ„í•œ<br>ì „ë¬¸ê°€ ìˆ™ì†Œ ë¶„ì„ ë³´ê¸°</h4>
                            <p class="text-gray-400 text-xs mt-2 group-hover:text-gray-300 transition">ë” ìì„¸í•œ ë¦¬ë·°ì™€ ê¿€íŒì„ í™•ì¸í•˜ì„¸ìš”</p>
                        </div>
                        <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white group-hover:bg-primary group-hover:text-white transition duration-300">
                            <i class="fa-solid fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
            </a>
        </section>

        <footer class="bg-gray-50 pt-8 pb-8 px-5 border-t border-gray-100 mt-auto">
            <div class="text-[10px] text-gray-400 leading-relaxed text-center">
                <p class="mb-2">ë³¸ ì„œë¹„ìŠ¤ëŠ” íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <p class="font-bold text-gray-300">Â© 2026 StayPick AI.</p>
            </div>
        </footer>
    </div>

    <script>
        // ============================================
        // âš ï¸ [ìƒˆ ë°°í¬] í›„ ë°œê¸‰ë°›ì€ 'ì›¹ ì•± URL'ì„ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”!
        const API_URL = "https://script.google.com/macros/s/AKfycbyxvoBZzXldh2sRXnw6eX18o89em0qfQTL7Lwt4afoqe0w5qa0nEoD_BME-q_ryoHOLdw/exec"; 
        // ============================================

        let allAccommodations = [];
        let filteredAccommodations = [];
        let currentModalId = null;

        // í•„í„° ìƒíƒœ ê´€ë¦¬
        let currentSort = 'recommend';
        let currentLocation = 'all';

        window.onload = async function() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                initData(data);
            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('main-list').innerHTML = '<div class="text-center py-10 text-red-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
                document.getElementById('total-count').innerText = "Error";
            }
            document.getElementById('search-input').addEventListener('input', handleSearch);
        };

        function initData(data) {
            allAccommodations = data.map(item => ({
                ...item,
                comments: item.comments || []
            }));
            applyUnifiedFilter(); // ì´ˆê¸° ë Œë”ë§
        }

        // --- ì‹ ê·œ í•„í„° ë¡œì§ ---
        function changeSort(type, btnElement) {
            currentSort = type;
            // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            const buttons = document.querySelectorAll('#sort-filter-container button');
            buttons.forEach(btn => {
                btn.classList.remove('active', 'bg-dark', 'text-white', 'border-dark');
                btn.classList.add('bg-white', 'text-gray-500', 'border-gray-200');
            });
            btnElement.classList.remove('bg-white', 'text-gray-500', 'border-gray-200');
            btnElement.classList.add('active', 'bg-dark', 'text-white', 'border-dark');
            
            applyUnifiedFilter();
        }

        function toggleLocDropdown() {
            const dropdown = document.getElementById('location-dropdown');
            dropdown.classList.toggle('hidden');
        }

        function changeLocation(loc) {
            currentLocation = loc;
            const btnText = loc === 'all' ? 'ëª¨ë“  ì§€ì—­' : loc;
            document.getElementById('current-loc-text').innerText = btnText;
            
            // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.getElementById('location-dropdown').classList.add('hidden');
            
            // ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ (ì„ íƒëœ í•­ëª© ê°•ì¡°)
            const options = document.querySelectorAll('#location-dropdown button');
            options.forEach(opt => {
                if(opt.innerText.includes(loc) || (loc === 'all' && opt.innerText.includes('ì „ì²´'))) {
                    opt.classList.add('text-primary', 'font-bold');
                    opt.classList.remove('text-gray-500');
                } else {
                    opt.classList.remove('text-primary', 'font-bold');
                    opt.classList.add('text-gray-500');
                }
            });

            applyUnifiedFilter();
        }

        // í†µí•© í•„í„° ì ìš© í•¨ìˆ˜
        function applyUnifiedFilter() {
            let result = [...allAccommodations];

            // 1. ì§€ì—­ í•„í„°ë§
            if (currentLocation !== 'all') {
                result = result.filter(item => item.location.includes(currentLocation));
            }

            // 2. ì •ë ¬ ì ìš©
            if (currentSort === 'price') {
                result.sort((a, b) => a.price - b.price);
            } else if (currentSort === 'recommend') {
                result.sort((a, b) => b.recommendCount - a.recommendCount);
            } else if (currentSort === 'rating') {
                result.sort((a, b) => b.rating - a.rating);
            } else if (currentSort === 'reviews') { 
                // [ìˆ˜ì •ë¨] ë‚´ë¶€ ëŒ“ê¸€ ìˆ˜(comments.length) ëŒ€ì‹  ì‹¤ì œ ë¦¬ë·° ìˆ˜(reviewCount)ë¡œ ì •ë ¬
                result.sort((a, b) => b.reviewCount - a.reviewCount);
            }

            filteredAccommodations = result;
            renderMainList(filteredAccommodations);
        }

        function handleSearch(e) {
            const query = e.target.value.toLowerCase().trim();
            // ê²€ìƒ‰ ì‹œì—ëŠ” ì „ì²´ ë°ì´í„°ì—ì„œ ê²€ìƒ‰
            
            if (!query) {
                applyUnifiedFilter(); // ê²€ìƒ‰ì–´ ì—†ìœ¼ë©´ ê¸°ì¡´ í•„í„° ìƒíƒœ ë³µêµ¬
                return;
            }

            filteredAccommodations = allAccommodations.filter(item => 
                item.name.toLowerCase().includes(query) || 
                item.location.toLowerCase().includes(query) ||
                item.amenities.toLowerCase().includes(query)
            );
            renderMainList(filteredAccommodations);
        }

        // --- ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ---
        function renderMainList(data) {
            const listEl = document.getElementById('main-list');
            document.getElementById('total-count').innerText = `${data.length}ê°œ`;
            listEl.innerHTML = '';
            if (data.length === 0) { listEl.innerHTML = '<div class="text-center py-10 text-gray-400">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
            
            data.forEach((item, idx) => {
                const priceFormatted = new Intl.NumberFormat('ko-KR').format(item.price);
                const amenitiesStr = item.amenities || "";
                const amenitiesTags = amenitiesStr.split(',').slice(0, 3).map(tag => `<span class="inline-block bg-gray-100 text-gray-500 text-[10px] px-1.5 py-0.5 rounded-[4px] mr-1 mb-1">${tag.trim()}</span>`).join('');
                
                const isLiked = localStorage.getItem(`liked_${item.id}`) ? 'text-primary' : 'text-gray-400 hover:text-primary';

                const html = `
                    <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm flex gap-4 animate-fade-in-up hover:shadow-md transition relative group" style="animation-delay: ${idx * 0.05}s">
                        <div class="w-24 h-24 rounded-lg overflow-hidden shrink-0 relative bg-gray-100">
                            <img src="${item.image}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500" loading="lazy">
                            <div class="absolute top-0 left-0 bg-black/50 backdrop-blur-[1px] text-white text-[9px] px-1.5 py-0.5 rounded-br-lg">${item.location}</div>
                        </div>
                        <div class="flex-1 flex flex-col min-w-0">
                            <div class="mb-1">
                                <h4 class="font-bold text-dark text-sm truncate pr-4">${item.name}</h4>
                                <p class="text-xs text-gray-400 truncate mt-0.5">${item.intro}</p>
                            </div>
                            <div class="mb-2 flex flex-wrap">${amenitiesTags}</div>
                            
                            <div class="mt-auto flex justify-between items-end border-t border-gray-50 pt-2 relative z-20">
                                <div class="flex items-center gap-3">
                                    <button onclick="toggleRecommend(${item.id}, this)" class="flex items-center gap-1 text-xs font-medium transition ${isLiked}">
                                        <i class="fa-solid fa-thumbs-up"></i> <span class="like-count">${item.recommendCount}</span>
                                    </button>
                                    <span class="text-gray-200 text-[10px]">|</span>
                                    <button onclick="openCommentModal(${item.id})" class="flex items-center gap-1 text-xs font-medium text-gray-400 hover:text-dark transition">
                                        <i class="fa-solid fa-comment-dots"></i> <span>${item.comments.length}</span>
                                    </button>
                                </div>
                                <div class="text-right pointer-events-none">
                                    <div class="flex items-center justify-end mb-0.5">
                                        <i class="fa-solid fa-star text-yellow-400 text-[10px] mr-1"></i>
                                        <span class="text-xs font-bold text-dark mr-1">${item.rating}</span>
                                        <span class="text-[10px] text-gray-400">(${item.reviewCount})</span>
                                    </div>
                                    <span class="text-base font-bold text-primary">â‚©${priceFormatted}</span>
                                </div>
                            </div>
                        </div>
                        <a href="${item.link}" target="_blank" class="absolute inset-0 z-10"></a>
                    </div>`;
                listEl.innerHTML += html;
            });
        }

        // --- ê¸°ëŠ¥ ë¡œì§ ---
        function toggleRecommend(id, btnElement) {
            const storageKey = `liked_${id}`;
            if (localStorage.getItem(storageKey)) {
                alert("ì´ë¯¸ ì¶”ì²œí•˜ì…¨ìŠµë‹ˆë‹¤!");
                return;
            }

            const item = allAccommodations.find(i => i.id === id);
            if (item) {
                item.recommendCount++;
                btnElement.classList.remove('text-gray-400');
                btnElement.classList.add('text-primary');
                btnElement.querySelector('.like-count').innerText = item.recommendCount;
                localStorage.setItem(storageKey, 'true');

                fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({ action: 'like', id: id })
                }).catch(err => console.error("ì¶”ì²œ ì „ì†¡ ì˜¤ë¥˜:", err));
            }
        }

        function openCommentModal(id) {
            currentModalId = id;
            const item = allAccommodations.find(i => i.id === id);
            const list = document.getElementById('modal-comments-list');
            list.innerHTML = '';

            if (!item.comments || item.comments.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 text-sm py-10">ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
            } else {
                [...item.comments].reverse().forEach(c => {
                    list.innerHTML += `
                        <div class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm">
                            <p class="text-sm text-dark mb-1">${c.text}</p>
                            <span class="text-[10px] text-gray-400">${c.date}</span>
                        </div>
                    `;
                });
            }
            const modal = document.getElementById('comment-modal');
            modal.classList.remove('modal-hidden');
            modal.classList.add('modal-visible');
        }

        function closeCommentModal() {
            const modal = document.getElementById('comment-modal');
            modal.classList.remove('modal-visible');
            modal.classList.add('modal-hidden');
            currentModalId = null;
        }

        function showSuccessModal() {
            const modal = document.getElementById('success-modal');
            modal.classList.remove('modal-hidden');
            modal.classList.add('modal-visible');
            
            // 1.5ì´ˆ í›„ ìë™ ë‹«ê¸°
            setTimeout(() => {
                modal.classList.remove('modal-visible');
                modal.classList.add('modal-hidden');
            }, 1500);
        }

        function submitComment() {
            const input = document.getElementById('comment-input');
            const text = input.value.trim();
            if (!text) { alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
            
            const item = allAccommodations.find(i => i.id === currentModalId);
            if (item) {
                const today = new Date().toISOString().split('T')[0];
                
                if (!item.comments) item.comments = [];
                item.comments.push({ text: text, date: today });
                item.commentCount = item.comments.length; 
                
                input.value = '';
                openCommentModal(currentModalId); // ëŒ“ê¸€ ëª©ë¡ ê°±ì‹ 
                applyUnifiedFilter(); // ë©”ì¸ ë¦¬ìŠ¤íŠ¸(ëŒ“ê¸€ìˆ˜ ë°˜ì˜) ê°±ì‹ 
                
                // ì„±ê³µ ì•Œë¦¼ ëª¨ë‹¬ í‘œì‹œ
                showSuccessModal();

                // ì„œë²„ ì „ì†¡
                fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({ 
                        action: 'comment', 
                        id: currentModalId, 
                        text: text, 
                        date: today 
                    })
                }).catch(err => console.error("ëŒ“ê¸€ ì „ì†¡ ì˜¤ë¥˜:", err));
            }
        }

        function startAnalysis() {
            if(allAccommodations.length === 0) { alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”."); return; }
            document.getElementById('loading-overlay').classList.remove('hidden');
            const msgs = ["ì—¬í–‰ ìŠ¤íƒ€ì¼ ë¶„ì„ ì¤‘...", "ìœ„ì¹˜ ë° ì¹˜ì•ˆ ë°ì´í„° ëŒ€ì¡°...", "ìµœì ì˜ ìˆ™ì†Œ ì„ ë³„ ì™„ë£Œ!"];
            let i = 0;
            const interval = setInterval(() => { i++; if (i < msgs.length) document.getElementById('loading-text').innerText = msgs[i]; }, 800);
            setTimeout(() => {
                clearInterval(interval);
                runRecommendation();
                document.getElementById('loading-overlay').classList.add('hidden');
                document.getElementById('result-container').classList.remove('hidden');
                document.getElementById('result-container').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 2500);
        }

        function runRecommendation() {
            const who = document.querySelector('input[name="who"]:checked').value;
            const vibe = document.querySelector('input[name="vibe"]:checked').value;
            const loc = document.getElementById('pref-location').value;
            
            let scored = allAccommodations.map(item => {
                if(loc !== 'all' && !item.location.includes(loc)) return null;
                
                let score = item.rating * 10;
                const text = (item.intro + item.amenities + item.name).toLowerCase();
                
                if (who === 'couple' && (text.includes('ë·°') || text.includes('ë¡œë§¨í‹±'))) score += 20;
                if (who === 'friends' && (text.includes('ë„“') || text.includes('íŒŒí‹°'))) score += 20;
                if (who === 'solo' && (text.includes('ì¹˜ì•ˆ') || text.includes('ì—­'))) score += 25;
                if (who === 'work' && (text.includes('ì±…ìƒ') || text.includes('ì™€ì´íŒŒì´'))) score += 25;
                
                if (vibe === 'price') score += (300000 - item.price) / 5000;
                if (vibe === 'photo' && text.includes('ê°ì„±')) score += 15;
                if (vibe === 'local' && text.includes('í˜„ì§€')) score += 15;
                
                score += (item.recommendCount * 0.5);

                return { ...item, score: score };
            }).filter(i => i !== null);
            
            scored.sort((a, b) => b.score - a.score);
            renderRecommendations(scored.slice(0, 3));
        }

        function renderRecommendations(items) {
            const container = document.getElementById('recommendation-list');
            container.innerHTML = '';
            if(items.length === 0) { container.innerHTML = '<div class="w-full text-center text-gray-400 py-4">ì¡°ê±´ì— ë§ëŠ” ìˆ™ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
            items.forEach((item, idx) => {
                const price = new Intl.NumberFormat('ko-KR').format(item.price);
                container.innerHTML += `
                    <div class="snap-center shrink-0 w-[280px] bg-white rounded-2xl shadow-float overflow-hidden border border-gray-100 relative group">
                        <div class="h-40 relative">
                            <span class="absolute top-3 left-3 bg-primary text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm z-10">AI Match ${(98 - idx*2)}%</span>
                            <img src="${item.image}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-4">
                            <h4 class="font-bold text-dark truncate mb-1">${item.name}</h4>
                            <p class="text-xs text-gray-500 line-clamp-1 mb-2">${item.intro}</p>
                            <div class="flex justify-between items-center border-t border-gray-50 pt-3">
                                <span class="font-bold text-primary">â‚©${price}</span>
                                <a href="${item.link}" target="_blank" class="bg-dark text-white text-xs font-bold px-3 py-1.5 rounded-lg">ì˜ˆì•½</a>
                            </div>
                        </div>
                    </div>`;
            });
        }
        function resetAI() { document.getElementById('result-container').classList.add('hidden'); window.scrollTo({ top: 0, behavior: 'smooth' }); }
        
        // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('location-dropdown');
            const button = document.getElementById('loc-btn');
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });
    </script>
</body>
</html>